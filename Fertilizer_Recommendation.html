<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fertilizer Recommendation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00E676;
            --primary-dark: #00C853;
            --accent: #B2FF59;
            --glass-bg: rgba(20, 40, 30, 0.6);
            --glass-border: rgba(0, 230, 118, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align top to make room for bottom scene */
            padding-top: 50px;
            background: radial-gradient(circle at center, #143623 0%, #05140d 100%);
            overflow: hidden;
            position: relative;
        }

        /* =========================================
           1. BACKGROUND CHEM ANIMATION
           ========================================= */
        .chem-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .chem-particle {
            position: absolute;
            color: rgba(0, 230, 118, 0.2);
            font-family: 'Courier New', monospace;
            font-weight: 700;
            user-select: none;
            text-shadow: 0 0 10px rgba(0, 230, 118, 0.1);
            animation: slowFloat linear infinite;
        }

        @keyframes slowFloat {
            0% { transform: translateY(100vh) rotate(-20deg); opacity: 0; }
            20% { opacity: 0.5; }
            80% { opacity: 0.5; }
            100% { transform: translateY(-20vh) rotate(20deg); opacity: 0; }
        }

        /* =========================================
           2. GLASS FORM (Unchanged Design)
           ========================================= */
        .container {
            position: relative;
            z-index: 20; /* Above the farm scene */
            width: 90%;
            max-width: 500px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: #fff;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(0, 230, 118, 0.5);
        }

        .subtitle { color: rgba(255, 255, 255, 0.7); font-size: 14px; margin-bottom: 35px; font-weight: 300; }
        .input-group { position: relative; margin-bottom: 25px; text-align: left; }
        .input-group label { color: var(--primary); font-size: 12px; font-weight: 700; margin-left: 10px; text-transform: uppercase; letter-spacing: 1px; }
        input { width: 100%; padding: 15px 20px; margin-top: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: white; font-size: 16px; font-family: 'Poppins', sans-serif; transition: all 0.3s ease; }
        input:focus { outline: none; border-color: var(--primary); background: rgba(0, 0, 0, 0.5); box-shadow: 0 0 15px rgba(0, 230, 118, 0.2); }
        input::placeholder { color: rgba(255, 255, 255, 0.3); }
        button { width: 100%; padding: 18px; margin-top: 10px; border-radius: 12px; border: none; background: linear-gradient(90deg, #00C853, #69F0AE); color: #003d00; font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(0, 230, 118, 0.3); }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 230, 118, 0.5); }
        .result-box { margin-top: 30px; padding: 20px; border-radius: 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); display: none; border-left: 4px solid var(--primary); text-align: left; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .res-label { display: block; font-size: 12px; color: var(--accent); margin-bottom: 4px; text-transform: uppercase; }
        .res-value { font-size: 18px; color: white; font-weight: 600; margin-bottom: 10px; }
        .loader { display: none; width: 24px; height: 24px; border: 3px solid rgba(0, 50, 0, 0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* =========================================
           3. FULL WIDTH FARM SCENE
           ========================================= */
        .farm-scene {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 350px; /* Taller area for crops */
            z-index: 10;
            overflow: hidden;
            pointer-events: none;
        }

        .farm-scene svg {
            width: 100%;
            height: 100%;
        }

        /* Crop Animations */
        .healthy-plant { transform-origin: 50% 100%; animation: sway 4s ease-in-out infinite; }
        @keyframes sway { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(4deg); } }

        .diseased-plant { transform-origin: 50% 100%; animation: droop 6s ease-in-out infinite; }
        @keyframes droop { 0%, 100% { transform: rotate(5deg) scaleY(0.95); } 50% { transform: rotate(8deg) scaleY(0.92); } }

        /* Drone Animation */
        .drone-group {
            animation: flyAcross 20s linear infinite;
        }
        
        .prop { 
            transform-box: fill-box; 
            transform-origin: center; 
            animation: spinProp 0.1s linear infinite; 
        }
        
        .spray-cone {
            opacity: 0.6;
            animation: sprayPulse 0.2s infinite alternate;
        }

        @keyframes flyAcross {
            0% { transform: translateX(-150px); }
            45% { transform: translateX(110vw); } /* Fly off screen right */
            45.01% { transform: translateX(110vw) scaleX(-1); } /* Flip instantly */
            50% { transform: translateX(110vw) scaleX(-1); } /* Pause briefly */
            95% { transform: translateX(-150px) scaleX(-1); } /* Fly back left */
            95.01% { transform: translateX(-150px) scaleX(1); } /* Flip back */
            100% { transform: translateX(-150px) scaleX(1); }
        }

        @keyframes spinProp { 100% { transform: rotate(360deg); } }
        @keyframes sprayPulse { 0% { opacity: 0.4; transform: scaleY(1); } 100% { opacity: 0.7; transform: scaleY(1.1); } }

    </style>
</head>
<body>

    <div class="chem-container" id="chemContainer"></div>

    <div class="container">
        <h1>üß™ Fertilizer AI</h1>
        <p class="subtitle">Enter crop details to generate the chemical formula.</p>

        <form id="fertilizerForm">
            <div class="input-group">
                <label>Crop Type</label>
                <input type="text" id="fertilizer_crop" placeholder="e.g. Wheat, Rice, Cotton" required autocomplete="off">
            </div>

            <div class="input-group">
                <label>Observed Issue / Disease</label>
                <input type="text" id="fertilizer_disease" placeholder="e.g. Yellowing leaves, Stunted growth" required autocomplete="off">
            </div>

            <button type="submit" id="submitBtn">
                <span id="btnText">Generate Solution</span>
                <div class="loader" id="loader"></div>
            </button>
        </form>

        <div class="result-box" id="resultBox">
            <div>
                <span class="res-label">Recommended Fertilizer</span>
                <div class="res-value" id="resFertilizer">---</div>
            </div>
            <div>
                <span class="res-label">Recommended Dosage</span>
                <div class="res-value" id="resQuantity" style="margin-bottom:0; color: #B2FF59;">---</div>
            </div>
        </div>
    </div>

    <div class="farm-scene">
        <svg viewBox="0 0 1920 350" preserveAspectRatio="xMidYMax slice">
            <defs>
                <g id="plant-healthy">
                    <path d="M0,0 Q-10,-40 -20,-30" stroke="#2ecc71" stroke-width="4" fill="none"/>
                    <path d="M0,0 Q10,-50 30,-40" stroke="#2ecc71" stroke-width="4" fill="none"/>
                    <path d="M0,0 L0,-60" stroke="#27ae60" stroke-width="3"/>
                    <path d="M0,-60 L-5,-80 M0,-60 L5,-80" stroke="#27ae60" stroke-width="2"/>
                </g>

                <g id="plant-diseased">
                    <path d="M0,0 Q-15,-20 -30,-10" stroke="#AFB42B" stroke-width="4" fill="none"/> <path d="M0,0 Q15,-25 35,-15" stroke="#C0CA33" stroke-width="4" fill="none"/> <path d="M0,0 L5,-50" stroke="#827717" stroke-width="3"/> <circle cx="-15" cy="-15" r="2" fill="#3E2723"/>
                    <circle cx="20" cy="-20" r="2" fill="#3E2723"/>
                </g>

                <g id="drone-unit">
                    <path class="spray-cone" d="M0,20 L-20,100 L20,100 Z" fill="url(#sprayGrad)" />
                    <rect x="-30" y="-10" width="60" height="20" rx="5" fill="#ecf0f1"/>
                    <rect x="-10" y="5" width="20" height="10" rx="2" fill="#3498db"/> <line x1="-30" y1="0" x2="-50" y2="-15" stroke="#bdc3c7" stroke-width="3"/>
                    <line x1="30" y1="0" x2="50" y2="-15" stroke="#bdc3c7" stroke-width="3"/>
                    <ellipse cx="-50" cy="-15" rx="15" ry="3" fill="rgba(255,255,255,0.6)" class="prop"/>
                    <ellipse cx="50" cy="-15" rx="15" ry="3" fill="rgba(255,255,255,0.6)" class="prop"/>
                </g>

                <linearGradient id="sprayGrad" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#B2FF59" stop-opacity="0.8"/>
                    <stop offset="100%" stop-color="#B2FF59" stop-opacity="0"/>
                </linearGradient>
            </defs>

            <g transform="translate(0, 300) scale(0.8)">
                <use href="#plant-diseased" x="50" y="0" class="diseased-plant" style="animation-delay:0.1s"/>
                <use href="#plant-healthy" x="200" y="0" class="healthy-plant" style="animation-delay:0.2s"/>
                <use href="#plant-diseased" x="350" y="0" class="diseased-plant" style="animation-delay:0.5s"/>
                <use href="#plant-diseased" x="500" y="0" class="diseased-plant" style="animation-delay:0.8s"/>
                <use href="#plant-healthy" x="650" y="0" class="healthy-plant" style="animation-delay:1.1s"/>
                <use href="#plant-diseased" x="800" y="0" class="diseased-plant" style="animation-delay:1.3s"/>
                <use href="#plant-healthy" x="950" y="0" class="healthy-plant" style="animation-delay:0.4s"/>
                <use href="#plant-diseased" x="1100" y="0" class="diseased-plant" style="animation-delay:0.9s"/>
                <use href="#plant-healthy" x="1250" y="0" class="healthy-plant" style="animation-delay:1.5s"/>
                <use href="#plant-diseased" x="1400" y="0" class="diseased-plant" style="animation-delay:0.3s"/>
                <use href="#plant-healthy" x="1550" y="0" class="healthy-plant" style="animation-delay:1.8s"/>
                <use href="#plant-diseased" x="1700" y="0" class="diseased-plant" style="animation-delay:0.7s"/>
                <use href="#plant-healthy" x="1850" y="0" class="healthy-plant" style="animation-delay:1.2s"/>
            </g>

            <g transform="translate(80, 320) scale(1.0)">
                <use href="#plant-healthy" x="0" y="0" class="healthy-plant" style="animation-delay:0.5s"/>
                <use href="#plant-diseased" x="150" y="0" class="diseased-plant" style="animation-delay:1.2s"/>
                <use href="#plant-healthy" x="300" y="0" class="healthy-plant" style="animation-delay:0.3s"/>
                <use href="#plant-healthy" x="450" y="0" class="healthy-plant" style="animation-delay:0.9s"/>
                <use href="#plant-diseased" x="600" y="0" class="diseased-plant" style="animation-delay:1.5s"/>
                <use href="#plant-healthy" x="750" y="0" class="healthy-plant" style="animation-delay:0.1s"/>
                <use href="#plant-diseased" x="900" y="0" class="diseased-plant" style="animation-delay:1.8s"/>
                <use href="#plant-healthy" x="1050" y="0" class="healthy-plant" style="animation-delay:0.6s"/>
                <use href="#plant-diseased" x="1200" y="0" class="diseased-plant" style="animation-delay:1.1s"/>
                <use href="#plant-healthy" x="1350" y="0" class="healthy-plant" style="animation-delay:0.4s"/>
                <use href="#plant-diseased" x="1500" y="0" class="diseased-plant" style="animation-delay:1.4s"/>
                <use href="#plant-healthy" x="1650" y="0" class="healthy-plant" style="animation-delay:0.8s"/>
            </g>

            <g class="drone-group" transform="translate(0, 100)">
                <use href="#drone-unit" x="0" y="0" width="100" height="100"/>
            </g>

            <g transform="translate(0, 350) scale(1.3)">
                <use href="#plant-diseased" x="80" y="0" class="diseased-plant" style="animation-delay:0.2s"/>
                <use href="#plant-healthy" x="250" y="0" class="healthy-plant" style="animation-delay:0.7s"/>
                <use href="#plant-diseased" x="420" y="0" class="diseased-plant" style="animation-delay:1.4s"/>
                <use href="#plant-healthy" x="590" y="0" class="healthy-plant" style="animation-delay:0.3s"/>
                <use href="#plant-healthy" x="760" y="0" class="healthy-plant" style="animation-delay:1.1s"/>
                <use href="#plant-diseased" x="930" y="0" class="diseased-plant" style="animation-delay:0.5s"/>
                <use href="#plant-healthy" x="1100" y="0" class="healthy-plant" style="animation-delay:1.6s"/>
                <use href="#plant-diseased" x="1270" y="0" class="diseased-plant" style="animation-delay:0.9s"/>
                <use href="#plant-healthy" x="1440" y="0" class="healthy-plant" style="animation-delay:0.4s"/>
            </g>
        </svg>
    </div>

    <script>
        // --- 1. Generate Floating Chemicals ---
        function createChemicals() {
            const container = document.getElementById('chemContainer');
            const formulas = ['N', 'P', 'K', 'Zn', 'Mg', 'Ca', 'S', 'Fe', 'NH‚ÇÑ‚Å∫', 'NO‚ÇÉ‚Åª', 'H‚ÇÇPO‚ÇÑ‚Åª'];
            const count = 25;

            for(let i=0; i<count; i++) {
                const el = document.createElement('div');
                el.innerText = formulas[Math.floor(Math.random() * formulas.length)];
                el.className = 'chem-particle';
                
                const size = Math.random() * 20 + 14; 
                el.style.fontSize = `${size}px`;
                el.style.left = `${Math.random() * 100}%`;
                el.style.animationDuration = `${Math.random() * 20 + 15}s`; 
                el.style.animationDelay = `${Math.random() * 15}s`;
                
                container.appendChild(el);
            }
        }
        createChemicals();

        // --- 2. Form Logic (Unchanged) ---
        const form = document.getElementById('fertilizerForm');
        const resultBox = document.getElementById('resultBox');
        const btnText = document.getElementById('btnText');
        const loader = document.getElementById('loader');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            btnText.style.display = 'none';
            loader.style.display = 'block';
            submitBtn.disabled = true;
            resultBox.style.display = 'none';

            const data = {
                crop: document.getElementById('fertilizer_crop').value,
                disease: document.getElementById('fertilizer_disease').value
            };

            try {
                const res = await fetch('http://localhost:5000/recommend-fertilizer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                
                btnText.style.display = 'block';
                loader.style.display = 'none';
                submitBtn.disabled = false;
                resultBox.style.display = 'block';

                if (res.ok) {
                    resultBox.style.borderLeftColor = '#00E676';
                    document.getElementById('resFertilizer').innerText = result.fertilizer;
                    document.getElementById('resFertilizer').style.color = '#fff';
                    document.getElementById('resQuantity').innerText = result.quantity;
                } else {
                    resultBox.style.borderLeftColor = '#FF5252';
                    document.getElementById('resFertilizer').innerText = "Error";
                    document.getElementById('resFertilizer').style.color = '#FF5252';
                    document.getElementById('resQuantity').innerText = result.error;
                }

            } catch (error) {
                btnText.style.display = 'block';
                loader.style.display = 'none';
                submitBtn.disabled = false;
                resultBox.style.display = 'block';
                resultBox.style.borderLeftColor = '#FF5252';
                document.getElementById('resFertilizer').innerText = "Connection Failed";
                document.getElementById('resFertilizer').style.color = '#FF5252';
                document.getElementById('resQuantity').innerText = "Ensure server is running.";
            }
        });
    </script>

</body>
</html>